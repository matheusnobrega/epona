{% extends 'core/base.html' %}

{% block content %}

<div class="form-container">
    <div class="form">
            <form action="" method="POST">
                {% csrf_token %}
                <h2 class="form-heading">Cadastro de casa de show</h2>
                <input type="text" id="name" name="name" placeholder="Nome" required>
                <input type="text" id="address" name="address" placeholder="Endereço" required>
                <input type="text" id="description" name="description" placeholder="Descrição" required>
                
                <select id="city" name="city" required>
                    {% for city in cities %}
                        <option value="{{ city.id }}">{{ city.name }} - {{ city.state.abbreviation }}</option>
                    {% endfor %}
                </select>

                <select id="restaurant" name="restaurant">
                </select>

                <input type="time" id="start-time" name="start-time" required>
                <select name="closing-day" required>
                    <option value="Sábado">Sábado</option>
                    <option value="Domingo">Domingo</option>
                    <option value="Segunda">Segunda</option>
                    <option value="Terça">Terça</option>
                    <option value="Quarta">Quarta</option>
                    <option value="Quinta">Quinta</option>
                    <option value="Sexta">Sexta</option>  
                </select>

                <button type="submit">Enviar</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
          var citySelect = document.getElementById('city');
          var restaurantSelect = document.getElementById('restaurant');
      
          citySelect.addEventListener('change', function() {
            var cityId = citySelect.value;
            var url = '/ajax/restaurants/?city_id=' + cityId;
      
            fetch(url)
              .then(function(response) {
                return response.json();
              })
              .then(function(data) {
                restaurantSelect.innerHTML = '';
      
                data.restaurants.forEach(function(restaurant) {
                  var option = document.createElement('option');
                  option.value = restaurant.id;
                  option.textContent = restaurant.name;
                  restaurantSelect.appendChild(option);
                });
                var option = document.createElement('option');
                option.value = '';
                option.textContent = 'Não possui restaurante';
                restaurantSelect.appendChild(option);
              });
          });
        });
      </script>
{% endblock %}